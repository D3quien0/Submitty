<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /usr/local/submitty/site/public

    DirectoryIndex index.html index.php index.htm index.cgi

    ScriptAlias "/cgi-bin" "/usr/local/submitty/site/cgi-bin"

    <Directory />
        Options Indexes FollowSymLinks Includes ExecCGI
        AddHandler cgi-script .cgi
        AllowOverride All
        Order deny,allow
        Allow from all
        Require all granted
        
        RewriteEngine On
        # If the requested filename exists, simply serve it.
        RewriteCond %{REQUEST_FILENAME} -f
        RewriteRule ^ - [L]

        # Else rewrite urls to be to some form of /index.php depending of if the
        # url already contains index.php or not
        RewriteRule ^(.+)/index\.php$ /index.php?url=$1&%{QUERY_STRING} [NC,END]
        RewriteRule ^(.+)$ /index.php?url=$1&%{QUERY_STRING} [NC,END]
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/submitty-error.log
    CustomLog ${APACHE_LOG_DIR}/submitty.log combined
</VirtualHost>
